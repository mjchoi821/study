# Item 71. 필요 없는 검사 예외 사용은 피하라

<br>

검사 예외는 제대로 활용하면 API와 프로그램의 질을 높일 수 있다.

하지만 과하게 사용하면 쓰기 불편한 API가 된다. 검사 예외를 던지는 메서드를 호출하는 코드는 `catch` 블록으로 예외를 처리하거나 더 바깥으로 던져 문제를 전파해야만 한다.

어느쪽이든 API 사용자에게 부담을 준다.

검사 예외를 던지는 메서드는 스트림 안에서 직접 사용할 수 없기 때문에 (아이템 45~48) 자바 8부터는 부담이 더욱 커졌다.

<br>

**검사 예외 사용**

- API를 제대로 사용해도 발생할 수 있는 예외
- 프로그래머가 의미 있는 조치를 취할 수 있는 경우

**비검사 예외 사용**

- 위 '검사 예외 사용'의 어디에도 해당하지 않을 경우

<br>

**프로그래머의 부담이 되는 경우**

> 하나의 검사 예외만 던지는 메서드의 경우 > 이미 다른 검사 예외가 존재하던 곳에 추가된 경우

오직 하나의 검사 예외만을 위해 `try` 블록을 추가해야 하고 스트림에서 직접 메서드를 사용할 수 없기 때문에, 이미 존재하는 메서드에 `catch` 만을 추가하는 경우보다 부담이 크게 된다.

따라서 이런 상황이라면 검사 예외를 던지지 않는 방법을 고민해 볼 수 있다.

<br>

### 검사 예외 대신 사용할 수 있는 방법

1. 적절한 결과 타입을 담은 옵셔널을 반환한다. ([아이템 55](Item55.md))

   - 검사 예외를 던지는 대신 단순히 빈 옵셔널을 반환한다

2. 검사 예외를 던지는 메서드를 2개로 쪼개 비검사 예외로 바꿀 수 있다.

   - 첫 번째 메서드는 예외가 던져질지 여부를 boolean 값으로 반환한다

   ```java
   // 검사 예외를 던지는 메서드 - 리팩토링 전
   try {
     obj.action(args);
   } catch (TheCheckedException e) {
     // ...   // 예외 상황에 대처한다
   }
   
   // 상태 검사 메서드와 비검사 예외를 던지는 메서드 - 리팩토링 후
   if (obj.actionPermitted(args)) {
     obj.action(args);
   } else {
     // ...   // 예외 상황에 대처한다
   }
   ```

   모든 상황에 이 리팩토링을 적용할 순 없지만, 적용할 수만 있다면 더 쓰기 편한 API를 제공할 수 있다.

   리팩토링 후의 API가 딱히 더 아름답진 않지만, 더 유연한 것은 확실하다.

   프로그래머가 이 메서드가 성공할것은 안다거나, 실패 시 스레드를 중단하길 원한다면 다음처럼 한줄로 작성해도 무방하다.

   ```java
   obj.action(args);  // try 문 없이 사용, 비검사 예외를 던지는 메서드이기 때문에 사용 가능
   ```

   이 한 줄짜리 호출 방식이 주로 쓰일거라 판단되면 리팩토링하는 편이 바람직하다.

   `actionPermitted` 는 상태 검사 메서드에 해당하므로 [아이템 69](Item69.md) 에서 말한 단점도 그대로 적용되니 주의해야 한다.

   **리팩토링이 적절하지 않은 상황**

   - 외부 요인에 의해 `actionPermitted` 와 `action` 호출 사이에 객체의 상태가 변할 수 있다면 이 리팩토링은 적절하지 않다
   - `actionPermitted` 가 `action` 메서드의 작업 일부를 중복 수행한다면 성능에서 손해기 때문에 리팩토링이 적절하지 않다

<br>

<br>

### 핵심 정리

- 꼭 필요한 곳에만 사용한다면 검사 예외는 프로그램의 안전성을 높여주지만, 남용하면 쓰기 고통스러운 API 를 낳는다
- API 호출자가 예외 상황에서 복구할 방법이 없다면 비검사 예외를 던지자
- 복구가 가능하고 호출자가 처리를 해주길 바란다면, 옵셔널을 반환해도 될지 고민하자
- 옵셔널만으로는 상황을 처리하기에 충분한 정보를 제공할 수 없을때만 검사 예외를 던지자

<br>

