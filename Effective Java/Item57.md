# Item 57. 지역변수의 범위를 최소화하라

### 왜? 지역변수의 유효 범위를 줄여야 하는가?

지역변수의 유효 범위를 최소로 줄이면 아래와 같은 효과를 얻을 수 있다.

- 코드 가독성과 유지보수성이 좋아지며

- 오류 가능성은 낮아진다

<br>

### 지역변수 범위를 줄이는 방법

1. 가장 처음 쓰일 때 선언하는 것  ⇢ **가장 강력한 방법!**

   - 사용하려면 멀었는데, 미리 선언부터 해두면 코드가 어수선해져 가독성이 떨어진다
   - 변수를 사용하는 시점엔 타입과 초기값이 기억나지 않을 수도 있다

2. 메서드를 작게 유지하고 한가지 기능에 집중하는 것

   - 한 메서드에서 여러 가지 기능을 처리한다면 그중 한 기능과만 관련된 지역변수라도 다른 기능을 수행하는 코드에서 접근할 수 있게된다

     해결책은 간단하다, 단순히 메서드를 기능별로 나누면 된다

<br>

### 우리가 저지르는 실수

- 변수가 쓰이는 시점보다 너무 앞서 선언하는 것

- 변수를 다 사용한 뒤에도 여전히 살아있는 것

  ⇢ 지역변수의 범위는 선언된 지점부터 그 지점을 포함한 블록이 끝날 때까지인데, 실수로 의도한 범위 앞 혹은 뒤에서 변수를 사용하면 끔찍한 결과로 이어질 수 있다

<br>

### 예외사항

(거의 모든) 지역 변수는 선언과 동시에 초기화 해야 한다. 만약 초기화에 필요한 정보가 충분하지 않다면 충분해질 때까지 선언을 미뤄야 한다.

그러나 `try-catch` 문은 이 규칙에서 예외다. 변수를 초기화하는 표현식에서 검사 예외를 던질 가능성이 있다면 try 블록 안에서 초기화해야 한다.

그리고 변수 값을 try 블록 바깥에서도 사용해야 한다면, try 블록 앞에서 선언해야 한다.

```java
// 65-1 예제 참고(일부)
public static void main(String[] args) {
  Class<? extends Set<String>> cl = null;
  try {
    cl = (Class<? extends Set<String>>) Class.forName(args[0]);
  } catch(ClassNotFoundException e) {
    fatalError("클래스를 찾을 수 없습니다.");
  }
  
  // ... cl 사용..
}
```

<br>

### 반복문의 변수 범위

- for문

  - 반복 변수의 범위가 반복문의 몸체, for 키워드, 몸체 사이의 괄호 안으로 제한된다
    따라서 반복 변수의 값을 반복문이 종료된 뒤에도 써야 하는 상황이 아니라면 while문보다 for문을 쓰는 편이 낫다

  ```java
  // 컬렉션이나 배열을 순회하는 권장 관용구 ⇢ 휴먼에러나 IndexOutOfBoundsException 의 위협에서 안전하다
  for (Element e: c) {
    // ...
    // 지역변수 e 를 이 범위에서만 사용이 가능하다
  }
  
  // 반복자를 사용해야 할 경우
  for (Iterator<Element> i = c.iterator(); i.hasNext();) {
    Element e = i.next();
    // ...
    // i 도 사용 가능
  }
  ```

- while문

  - while문으로 동일하게 동작할 수 있으나 실수가 발생할 수 있는 여지가 있고, 컴파일 타임에 확인되지 않는 문제라 오랜시간 문제를 확인조차 하지 못할 수도 있다

  ```java
  Iterator<Element> i = c.iterator();
  while (i.hasNext()) {
    doSomething(i.next());
  }
  // ...
  
  Iterator<Element> i2 = c2.iterator();
  while (i.hasNext()) {  // -----> 이부분이 버그이다. i2를 참조해야 하는데 위에 있는 지역변수 i 를 참조하고 있다
    doSomethingElse(i2.next()); // 심지어 이 버그는 컴파일 시 오류가 발생하지 않고, 동작 시에도 문제를 일으키지 않고 넘어가므로  
  }															// 오랜기간 문제가 발견되지 않을 수도 있다!!
  ```

  ⇢ 위와 동일한 상황을 for문으로 만들 경우 for문의 변수 범위를 벗어나기 때문에 컴파일러가 오류를 컴파일 타임에 알려준다

  ```java
  // 위와 동일한 내용을 for 문으로 만든 것
  for (Iterator<Element> i = c.iterator(); i.hasNext();) {
    Element e = i.next();
    // ...
  }
  // ...
  
  for (Iterator<Element> i2 = c2.iterator(); i.hasNext();) { // 'i를 찾을 수 없다'는 컴파일 오류가 발생한다
    Element e2 = i2.next();
    // ...
  }
  ```

<br>

#### for 문의 장점

- 변수 유효 범위가 for문 범위와 일치하여 같은 이름의 변수를 여러 반복문에서 써도 서로 아무 영향을 주지 않는다
- while문보다 짧아서 가독성이 좋다

<br>

### 지역변수의 범위를 최소화하는 반복문 관용구

```java
// 지역변수의 범위를 최소화하는 반복문 관용구
for (int i=0, n=expensiveComputation(); i<n; i++) {
  // i 사용 ...
}
```

- 반복 변수 `i`와 `n`의 범위가 동일

- 반복을 종료하는 값을  `n`에 저장하여, 반복마다 다시 계산해야 하는 비용을 없앴다

  만약, 조건식에서 같은 값을 반환하는 메서드를 매번 호출해서 사용한다면 이 관용구를 사용하자

<br>

